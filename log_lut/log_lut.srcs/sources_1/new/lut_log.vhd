----------------------------------------------------------------------------------
-- Company: 
-- Engineer: 
-- 
-- Create Date: 12/08/2024 08:27:24 AM
-- Design Name: 
-- Module Name: lut_log - Behavioral
-- Project Name: 
-- Target Devices: 
-- Tool Versions: 
-- Description: 
-- 
-- Dependencies: 
-- 
-- Revision:
-- Revision 0.01 - File Created
-- Additional Comments:
-- 
----------------------------------------------------------------------------------


library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;

entity combined_lut_log is
    port (
        a, b       : in  integer range 0 to 255;   -- 8-bit integer inputs
        log_result : out std_logic_vector(7 downto 0)  -- 8-bit output for log(a*b)
    );
end entity combined_lut_log;

architecture rtl of combined_lut_log is
    -- LUT definition
    type lut_array is array (0 to 255) of std_logic_vector(7 downto 0);
    constant log_lut : lut_array := (
        -- Replace with precomputed log2 values
        "00000000",
"00011111",
"00110010",
"00111111",
"01001010",
"01010010",
"01011001",
"01011111",
"01100101",
"01101001",
"01101110",
"01110010",
"01110101",
"01111001",
"01111100",
"01111111",
"10000010",
"10000100",
"10000111",
"10001001",
"10001100",
"10001110",
"10010000",
"10010010",
"10010100",
"10010101",
"10010111",
"10011001",
"10011010",
"10011100",
"10011101",
"10011111",
"10100000",
"10100010",
"10100011",
"10100100",
"10100110",
"10100111",
"10101000",
"10101001",
"10101010",
"10101011",
"10101100",
"10101110",
"10101111",
"10110000",
"10110001",
"10110010",
"10110010",
"10110011",
"10110100",
"10110101",
"10110110",
"10110111",
"10111000",
"10111001",
"10111001",
"10111010",
"10111011",
"10111100",
"10111101",
"10111101",
"10111110",
"10111111",
"10111111",
"11000000",
"11000001",
"11000010",
"11000010",
"11000011",
"11000100",
"11000100",
"11000101",
"11000101",
"11000110",
"11000111",
"11000111",
"11001000",
"11001000",
"11001001",
"11001010",
"11001010",
"11001011",
"11001011",
"11001100",
"11001100",
"11001101",
"11001101",
"11001110",
"11001110",
"11001111",
"11001111",
"11010000",
"11010000",
"11010001",
"11010001",
"11010010",
"11010010",
"11010011",
"11010011",
"11010100",
"11010100",
"11010101",
"11010101",
"11010110",
"11010110",
"11010110",
"11010111",
"11010111",
"11011000",
"11011000",
"11011000",
"11011001",
"11011001",
"11011010",
"11011010",
"11011010",
"11011011",
"11011011",
"11011100",
"11011100",
"11011100",
"11011101",
"11011101",
"11011110",
"11011110",
"11011110",
"11011111",
"11011111",
"11011111",
"11100000",
"11100000",
"11100000",
"11100001",
"11100001",
"11100001",
"11100010",
"11100010",
"11100010",
"11100011",
"11100011",
"11100011",
"11100100",
"11100100",
"11100100",
"11100101",
"11100101",
"11100101",
"11100110",
"11100110",
"11100110",
"11100111",
"11100111",
"11100111",
"11100111",
"11101000",
"11101000",
"11101000",
"11101001",
"11101001",
"11101001",
"11101001",
"11101010",
"11101010",
"11101010",
"11101011",
"11101011",
"11101011",
"11101011",
"11101100",
"11101100",
"11101100",
"11101100",
"11101101",
"11101101",
"11101101",
"11101110",
"11101110",
"11101110",
"11101110",
"11101111",
"11101111",
"11101111",
"11101111",
"11110000",
"11110000",
"11110000",
"11110000",
"11110001",
"11110001",
"11110001",
"11110001",
"11110010",
"11110010",
"11110010",
"11110010",
"11110010",
"11110011",
"11110011",
"11110011",
"11110011",
"11110100",
"11110100",
"11110100",
"11110100",
"11110101",
"11110101",
"11110101",
"11110101",
"11110101",
"11110110",
"11110110",
"11110110",
"11110110",
"11110110",
"11110111",
"11110111",
"11110111",
"11110111",
"11111000",
"11111000",
"11111000",
"11111000",
"11111000",
"11111001",
"11111001",
"11111001",
"11111001",
"11111001",
"11111010",
"11111010",
"11111010",
"11111010",
"11111010",
"11111011",
"11111011",
"11111011",
"11111011",
"11111011",
"11111100",
"11111100",
"11111100",
"11111100",
"11111100",
"11111100",
"11111101",
"11111101",
"11111101",
"11111101",
"11111101",
"11111110",
"11111110",
"11111110",
"11111110",
"11111110",
"11111111",
        others => "00000000" -- Default for unused entries
    );
begin
    process(a, b)
        variable log_a, log_b : unsigned(7 downto 0);
        variable combined_log : unsigned(8 downto 0); -- 9-bit for addition
    begin
        -- Handle edge cases for invalid inputs
        if a = 0 or b = 0 then
            log_result <= (others => '0'); -- Undefined log, set to 0
        else
            -- Lookup values from LUT
            log_a := unsigned(log_lut(a));
            log_b := unsigned(log_lut(b));
            
            -- Add logarithms
            combined_log := log_a + log_b;
            
            -- Handle overflow or truncation
            if combined_log > 255 then
                log_result <= std_logic_vector(to_unsigned(255, 8)); -- Saturate
            else
                log_result <= std_logic_vector(combined_log(7 downto 0)); -- Truncate
            end if;
        end if;
    end process;
end architecture rtl;

